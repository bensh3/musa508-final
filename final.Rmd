---
title: "MUSA 508 Final"
description: |
  Analyzing delays on New Jersey Transit & Amtrak
date: "2021-10-22"
author:
  - name: "Benjamin She"
url: https://github.com/bensh3/
output:
  distill::distill_article:
    toc: true
    toc_float: true
    code_folding: true
editor_options: 
  markdown: 
  wrap: sentence
  chunk_output_type: inline
knit: (function(input, ...) {
    rmarkdown::render(
      input,
      output_file = paste0(
        xfun::sans_ext(input), '_BenShe.html'
      ),
      envir = globalenv()
    )
  })
---
  <style>
  html {
    scroll-behavior: smooth;
  }
d-article {
  contain: none;
}
#TOC {
position: fixed;
top: 10px;
left: 10px;
padding: 10px;
text-align: right;
inline-size: 250px;
overflow-wrap: break-word;
}

@media screen and (max-width: 900px) {
  #TOC {
  position: relative;
}
}
</style>

```{r knitr_opts, include = FALSE}
knitr::opts_chunk$set(fig.path = 'figs/',
                      echo = TRUE, warning = FALSE, message = FALSE, cache.lazy = FALSE)
```

```{r}
library(data.table)
library(gganimate)
library(hms)
library(lubridate)
library(sf)
library(tidyverse)
library(tidytransit)
```


```{r intake delay data, echo=FALSE, message=FALSE}
delay_files <- list.files("delay",pattern="^20")
delay <- lapply(paste0('delay/',delay_files),read_csv)
names(delay) <- stringr::str_replace(delay_files, pattern = ".csv", replacement = "")
```

```{r intake GTFS data}
njt <- read_gtfs("gtfs_njt.zip")
njt_sf <- gtfs_as_sf(njt)

amtk <- read_gtfs("gtfs_amtk.zip") %>% filter_feed_by_stops(stop_ids=c('NWK'))
amtk_sf <- gtfs_as_sf(amtk)
```

```{r define time periods}

int.ampeak <- interval(as_hms("05:00:00"),as_hms("10:00:00"))
int.midday <- interval(as_hms("10:00:01"),as_hms("16:00:00"))
int.pmpeak <- interval(as_hms("16:00:01"),as_hms("20:00:00"))
int.evening <- interval(as_hms("20:00:01"),as_hms("23:00:00"))
int.overnight <- interval(as_hms("23:00:01"),as_hms("04:59:59"))

```


```{r 2019 delay data}
necl2019 <- rbindlist(delay %>% tidyselect:::select(starts_with('2019'))) %>% 
  filter(type == 'NJ Transit' & line == 'Northeast Corrdr') %>% 
  arrange(date,train_id,stop_sequence)

necl20190618 <- necl2019 %>% 
  filter(date %in% seq(as.Date("2019/06/18"), by = "day", length.out = 1))

necl.eb.id <- necl20190618 %>% filter(stop_sequence == 1 & from == 'Trenton') %>% 
  distinct(train_id)
necl.wb.id <- necl20190618 %>% filter(stop_sequence == 1 & from == 'New York Penn Station') %>% 
  distinct(train_id)
```
  
```{r}
necl20190618 %>% filter(train_id %in% sample(necl.eb.id,10)) %>%
  ggplot(aes(x=stop_sequence,y=delay_minutes,color=train_id)) +
  geom_line()
```



